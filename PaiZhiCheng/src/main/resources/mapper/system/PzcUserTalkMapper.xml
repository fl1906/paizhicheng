<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="top.flya.system.mapper.PzcUserTalkMapper">

    <resultMap type="top.flya.system.domain.vo.PzcUserTalkVo" id="PzcUserTalkResult">
        <result property="talkId" column="talk_id"/>
        <result property="fromUserId" column="from_user_id"/>
        <result property="toUserId" column="to_user_id"/>
        <result property="message" column="message"/>
        <result property="messageStatus" column="message_status"/>
        <result property="messageType" column="message_type"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
<!--        <result property="notReadCount" column="not_read_count"/>-->
    </resultMap>



    <select id="selectVoPageV1" resultMap="PzcUserTalkResult" >
          select talk_id,from_user_id,to_user_id,message,message_status,message_type,create_time,update_time from pzc_user_talk where from_user_id = #{userId} group by to_user_id order by create_time desc
    </select>

    <select id="selectNotReadCount" resultType="java.lang.Integer">
        select count(1) from pzc_user_talk where from_user_id = #{fromUserId} and to_user_id = #{toUserId} and message_status = 0
    </select>


<!--    <select id="selectVoPageV1" resultMap="PzcUserTalkResult">-->
<!--        SELECT t1.talk_id, t1.from_user_id, t1.to_user_id, t1.message, t1.message_status, t1.message_type, t1.create_time, t1.update_time,-->
<!--               (SELECT COUNT(t2.talk_id) FROM pzc_user_talk t2 WHERE t2.from_user_id = #{userId} AND t2.message_status = 0 GROUP BY t2.to_user_id ) AS not_read_count-->
<!--        FROM pzc_user_talk t1-->
<!--        WHERE t1.from_user_id = #{userId}-->
<!--        GROUP BY t1.to_user_id-->
<!--        ORDER BY t1.create_time DESC-->
<!--    </select>-->
</mapper>
